<!DOCTYPE html>

<html>
<head>
    <title>PyNode</title>
    <meta name="description" content="Interactive online Graph Theory.">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="css/style.css?version=0.9.7" rel="stylesheet" type="text/css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <script src="js/resize.js?version=0.9.7"></script>

    <script>
        var enable_editor = true;
    </script>
</head>

<body class="pynode_editor" onresize="editor_resize()">
<div class="pynodeEditorContainer">
    <div class="editorPageWrapper">
        <div class="editorWrapper">
            <div class="appSectionTitle">
                <div class="floatLeft">
                    <h3>Source</h3>
                </div>
                <div class="appSectionEnlarge">
                    <div class="appSectionBarIcon"><h3><a href=""
                                                          onclick="document.getElementById('file-input').click(); return false;"><img
                            src="images/controls/import.png" width="16" height="16"></a></h3></div>
                    <div class="appSectionBarIcon"><h3><a href="" onclick="userSaveCode(); return false;"><img
                            src="images/controls/save.png" width="16" height="16"></a></h3></div>
                </div>
            </div>
            <div id="editorBox">
                <div id="editor"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // Configure paths for Monaco globally
    var require = {
      paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs' }
    };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.nls.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/editor/editor.main.js"></script>

<script>
    resize();

    monaco.editor.defineTheme('default', {
        "base": "vs-dark",
        "inherit": true,
        "rules": [
            {
            "token": "keyword",
            "foreground": "FF69B4" // Hot pink for keywords
            },
            {
            "token": "identifier",
            "foreground": "FFC0CB" // Light pink for identifiers
            },
            {
            "token": "string",
            "foreground": "FFB6C1" // Lighter pink for strings
            },
            {
            "token": "number",
            "foreground": "FF1493" // Deep pink for numbers
            },
            {
            "token": "type",
            "foreground": "FF69B4" // Hot pink for types
            },
            {
            "token": "comment",
            "foreground": "EE82EE", // Violet for comments
            "fontStyle": "italic"
            },
            {
            "token": "variable",
            "foreground": "FFC0CB" // Light pink for variables
            },
            {
            "token": "function",
            "foreground": "FF69B4" // Hot pink for functions
            },
            {
            "token": "operator",
            "foreground": "FF1493" // Deep pink for operators
            }
        ],
        "colors": {
            "editor.background": "#2E2E3E", // Dark grey background
            "editor.foreground": "#FFC0CB", // Light pink foreground text
            "editor.lineHighlightBackground": "#3E3E4E", // Slightly lighter grey for line highlights
            "editor.selectionBackground": "#FF69B420", // Translucent hot pink for selection
            "editorCursor.foreground": "#FF69B4", // Hot pink cursor
            "editorWhitespace.foreground": "#5C5C6E" // Subtle grey for whitespace
        }
    });

    monaco.editor.setTheme('default');

    const editor = monaco.editor.create(document.getElementById('editor'), {
        language: "python",
        automaticLayout: true,
    });

    function setCode(src) {
        if (enable_editor) {
            editor.setValue(src);
        }
    }

    const openerSrc = window.opener?.editor?.getValue();
    if (openerSrc !== undefined) {
        editor.setValue(openerSrc);
    }

    monaco.languages.registerCompletionItemProvider('python', {
        provideCompletionItems: () => {
            return {
                suggestions: [
                    {
                        label: 'print',
                        kind: monaco.languages.CompletionItemKind.Function,
                        insertText: 'print(${1})',
                        insertTextRules: monaco.languages.CompletionItemInsertTextRule.InsertAsSnippet,
                        documentation: 'Print to the console',
                    },
                ],
            };
        },
    });

    editor.onDidChangeModelContent(() => {
        enable_editor = false;
        if (window.opener?.enable_editor) {
            window.opener.setCode(editor.getValue());
        }
        enable_editor = true;
    });

    window.editor = editor;

</script>

<input id="file-input" type="file" name="name" style="display: none;"/>
<script type="text/javascript" src="js/filesaver/filesaver.min.js?version=0.9.2"></script>
<script>
    function userLoadCode(event) {
        var files = event.target.files;
        var file = null;
        if (files.length > 0) file = files[0];
        else return;
        var reader = new FileReader();
        reader.onload = (function (theFile) {
            return function (e) {
                setCode(e.target.result);
            };
        })(file);
        reader.readAsText(file);
    }
    function userSaveCode() {
        var text = getCode();
        var blob = new Blob([text], {type: "text/plain;charset=utf-8;"});
        saveAs(blob, "project.pynode");
    }
    document.getElementById('file-input').addEventListener('change', userLoadCode, false);
</script>

</body>
</html>